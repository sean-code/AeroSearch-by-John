name: Ping Streamlit App (keep-awake)

# run on a schedule and allow manual trigger
on:
  schedule:
    - cron: '*/5 * * * *'   # every 5 minutes â€” change as desired
  workflow_dispatch: {}     # allows manual run from GitHub UI

concurrency:
  group: ping-streamlit
  cancel-in-progress: true

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Streamlit app (try up to 3 times)
        run: |
          URL="https://aerosearch-by-john.streamlit.app/"
          echo "Pinging $URL"
          # try up to 3 times with exponential backoff
          n=0
          until [ $n -ge 3 ]
          do
            # silent, follow redirects, reasonable timeout
            HTTP_STATUS=$(curl -sS -o /dev/null -w "%{http_code}" --max-time 20 --retry 2 --retry-delay 3 "$URL") || true
            echo "HTTP status: $HTTP_STATUS"
            if [ "$HTTP_STATUS" -ge 200 ] && [ "$HTTP_STATUS" -lt 400 ]; then
              echo "Success"
              break
            fi
            n=$((n+1))
            echo "Attempt $n failed; sleeping $((n * 6))s before retry"
            sleep $((n * 6))
          done
